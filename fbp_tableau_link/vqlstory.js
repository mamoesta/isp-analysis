/*! BEGIN StoryModule */
(function(){'dont use strict';var a={};global.tab=global.tab||{};ss.initAssembly(a,'vqlstory');var b=function(){};b.__typeName='tab.FlipboardNavigatorExtensions';b.getViewModelFromStoryId=function(A,B){return _.find(A,function(C){return C.get_storyPointId()===B;});};global.tab.FlipboardNavigatorExtensions=b;var c=function(){this.points=null;spiff.Template.call(this,$("<span class='tabFlipboardNavPoints'/>"));this.points=this.domRoot;};c.__typeName='tab.FlipboardNavigatorPointsTemplate';global.tab.FlipboardNavigatorPointsTemplate=c;var d=function(){this.previous=null;this.scroller=null;this.next=null;this.previousArrow=null;this.nextArrow=null;spiff.Template.call(this,$("<div class='tabFlipboardNav'><span class='tabFlipboardNavPrevious'><div class='tabStoryLeftArrow'/></span><span class='tabFlipboardNavScroller'/><span class='tabFlipboardNavNext'><div class='tabStoryRightArrow'/></span></div>"));this.previous=this.getElementBySelector('.tabFlipboardNavPrevious');this.scroller=this.getElementBySelector('.tabFlipboardNavScroller');this.next=this.getElementBySelector('.tabFlipboardNavNext');this.previousArrow=this.getElementBySelector('.tabStoryLeftArrow');this.nextArrow=this.getElementBySelector('.tabStoryRightArrow');};d.__typeName='tab.FlipboardNavigatorTemplate';global.tab.FlipboardNavigatorTemplate=d;var e=function(A){this.$m=null;this.$o=null;this.$n=null;ss.makeGenericType(spiff.BaseView$1,[f]).call(this,A,new d());this.$k();this.$f();this.get_flipboardNavViewModel().add_resizeZone(ss.mkdel(this,this.handleResize));this.get_flipboardNavViewModel().add_resizeZone(ss.mkdel(this,this.$a));this.get_flipboardNavViewModel().add_updateActivePoint(ss.mkdel(this,this.handleUpdateActivePoint));this.get_flipboardNavViewModel().add_remoteUpdateComplete(ss.mkdel(this,this.$c));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.get_flipboardNavViewModel().remove_resizeZone(ss.mkdel(this,this.handleResize));this.get_flipboardNavViewModel().remove_resizeZone(ss.mkdel(this,this.$a));this.get_flipboardNavViewModel().remove_updateActivePoint(ss.mkdel(this,this.handleUpdateActivePoint));this.get_flipboardNavViewModel().remove_remoteUpdateComplete(ss.mkdel(this,this.$c));tab.StyleUtil.clearStyleSheet('appendedStoryStyle');})));this.$b();};e.__typeName='tab.FlipboardNavigatorView';global.tab.FlipboardNavigatorView=e;var f=function(A){this.$d=null;this.$a=[];this.$c=false;this.$b=null;this.$e=null;this.$2$1=null;this.$2$2=null;this.$2$3=null;spiff.BaseViewModel.call(this);this.$d=A;this.$d.add_newFlipboardNav(ss.mkdel(this,this.handleNewFlipboardNav));this.$d.get_zone().get_zoneCommonModel().add_resizeZone(ss.mkdel(this,this.$4));this.$d.add_pointWasCaptured(ss.mkdel(this,this.handlePointWasCaptured));this.$d.add_navArrowVisibilityChanged(ss.mkdel(this,this.handleNavArrowVisibilityChanged));spiff.GlobalUIEvents.add_dismissTemporaryElements(ss.mkdel(this,this.hideUberMenuImmediately));y.$2(ss.mkdel(this,this.closeUberMenu));y.$4(ss.mkdel(this,this.handlePointWasCaptured));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$d.remove_newFlipboardNav(ss.mkdel(this,this.handleNewFlipboardNav));this.$d.get_zone().get_zoneCommonModel().remove_resizeZone(ss.mkdel(this,this.$4));this.$d.remove_pointWasCaptured(ss.mkdel(this,this.handlePointWasCaptured));this.$d.remove_navArrowVisibilityChanged(ss.mkdel(this,this.handleNavArrowVisibilityChanged));spiff.GlobalUIEvents.remove_dismissTemporaryElements(ss.mkdel(this,this.hideUberMenuImmediately));y.$3(ss.mkdel(this,this.closeUberMenu));y.$5(ss.mkdel(this,this.handlePointWasCaptured));this.$e.dispose();})));this.$e=tab.ObjectRegistry.resolve(m).call(null,[]);this.$b=[];this.$2();var B=null;B=ss.mkdel(this,function(){this.$9();tab.CommandController.get().remove_commandQueueComplete(B);});tab.CommandController.get().add_commandQueueComplete(B);tab.StartupUtils.callAfterBootstrap(ss.mkdel(this,function(){this.$9();}));};f.__typeName='tab.FlipboardNavigatorViewModel';global.tab.FlipboardNavigatorViewModel=f;var g=function(){spiff.Template.call(this,$("<div class='tabFlipboard'></div>"));};g.__typeName='tab.FlipboardTemplate';global.tab.FlipboardTemplate=g;var h=function(A){this.$a=null;ss.makeGenericType(spiff.BaseView$1,[i]).call(this,A,new g());this.$a=A;this.$a.add_newStoryPoint(ss.mkdel(this,this.handleNewStoryPoint));this.$a.get_parentZone().add_resizeZone(ss.mkdel(this,this.handleResizeZone));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$a.remove_newStoryPoint(ss.mkdel(this,this.handleNewStoryPoint));this.$a.get_parentZone().remove_resizeZone(ss.mkdel(this,this.handleResizeZone));})));};h.__typeName='tab.FlipboardView';h.findFlipboard=function(){return $('.tabFlipboard');};h.$0=function(A,B){var C=tab.SizeUtil.unionPresModels(A,B);if(B.h>=A.h+3&&A.w-B.w>24){C.w-=24;}if(B.w>=A.w&&A.h+3-B.h>24){C.h-=24;}return C;};global.tab.FlipboardView=h;var i=function(A,B){this.$7=null;this.$8=null;this.$6=null;this.$2$1=null;spiff.BaseViewModel.call(this);this.$7=A;this.$8=B;this.$7.add_invalidateZone(ss.mkdel(this,this.$4));this.$7.get_storyPointModel().add_newStoryPoint(ss.mkdel(this,this.$3));this.$7.get_storyPointModel().add_dashboardDisposal(ss.mkdel(this,this.$2));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$7.remove_invalidateZone(ss.mkdel(this,this.$4));this.$7.get_storyPointModel().remove_newStoryPoint(ss.mkdel(this,this.$3));this.$7.get_storyPointModel().remove_dashboardDisposal(ss.mkdel(this,this.$2));})));if(ss.isValue(this.get_flipboardModel().get_dashboardModel())){this.$3();}};i.__typeName='tab.FlipboardViewModel';global.tab.FlipboardViewModel=i;var j=function(){};j.__typeName='tab.IFlipboardNavigatorView';global.tab.IFlipboardNavigatorView=j;var k=function(){};k.__typeName='tab.IStoryNavigatorContentView';global.tab.IStoryNavigatorContentView=k;var l=function(){};l.__typeName='tab.IStoryNavigatorPointView';global.tab.IStoryNavigatorPointView=l;var m=function(){};m.__typeName='tab.IStoryUberPopupContainer';global.tab.IStoryUberPopupContainer=m;var n=function(){};n.__typeName='tab.StoryClientCommands';n.setActiveStoryPoint=function(A,B){var C=$.Deferred();if(!tab.ApplicationModel.get_instance().get_workbook().get_isCurrentSheetStoryboard()||B.get_currentPointIndex()===A){C.resolve();return C.promise();}var D=tab.ApplicationModel.get_instance().get_workbook().get_storyboard().get_flipboard();var E=B.get_storyPoints()[A].storyPointId;var F=new tab.ClientCommand('none',function(G){n.$m(E,B,G,D);},n.$0(B.get_storyPoints()[A].storyPointId,tsConfig.is_authoring),tab.CommandController.DeferredSuccessHandler(C),tab.CommandController.deferredFailureHandler(C));tab.CommandController.SendCommand(F);return C.promise();};n.nextStoryPoint=function(A){var B=$.Deferred();if(!tab.ApplicationModel.get_instance().get_workbook().get_isCurrentSheetStoryboard()){B.reject("The workbook's current sheet is not a story");return B.promise();}var C=A.get_currentPointIndex()+1;var D=tab.ApplicationModel.get_instance().get_workbook().get_storyboard().get_flipboard();var E=n.$f(A,B,D,C);var F=A.get_storyPoints()[C].storyPointId;var G=new tab.ClientCommand('none',function(H){n.$m(F,A,H,D);},n.$7(tsConfig.is_authoring),tab.CommandController.DeferredSuccessHandler(B),tab.CommandController.deferredFailureHandler(B));tab.CommandController.SendCommand(G);return E;};n.previousStoryPoint=function(A){var B=$.Deferred();if(ss.isNullOrUndefined(tab.ApplicationModel.get_instance().get_workbook().get_storyboard())){B.reject("The workbook's current sheet is not a story");return B.promise();}var C=A.get_currentPointIndex()-1;var D=tab.ApplicationModel.get_instance().get_workbook().get_storyboard().get_flipboard();var E=n.$f(A,B,D,C);var F=A.get_storyPoints()[C].storyPointId;var G=new tab.ClientCommand('none',function(H){n.$m(F,A,H,D);},n.$8(tsConfig.is_authoring),tab.CommandController.DeferredSuccessHandler(B),tab.CommandController.deferredFailureHandler(B));tab.CommandController.SendCommand(G);return E;};n.revertStoryPoint=function(A,B){return n.$l(n.$k,n.$b(A,B),null);};n.setFlipboardNavType=function(A){return n.$l(function(B){},n.$d(A),null);};n.captureStoryPoint=function(A){return n.$l(function(B){},n.$1(A),null);};n.newBlankStoryPoint=function(){return n.$l(function(A){},n.$6(),null);};n.duplicateActiveStoryPoint=function(){return n.$l(function(A){},n.$3(),null);};n.saveActiveStoryPointAsNew=function(){return n.$l(function(A){},n.$c(),'immediatelySubtle');};n.toggleArrows=function(){return n.$l(function(A){},n.$e(),null);};n.insertStoryPoint=function(A,B){return n.$l(function(C){},n.$5(A,B),null);};n.replaceStoryPoint=function(A,B){return n.$l(function(C){},n.$a(A,B),null);};n.reorderStoryPoint=function(A,B){return n.$l(function(C){},n.$9(A,B),null);};n.deleteStoryPoint=function(A){return n.$l(function(B){},n.$2(A),null);};n.editStoryPointCaption=function(A,B,C){return n.$l(function(D){n.$h(A,C,D);},n.$4(A,B),null);};n.$f=function(A,B,C,D){var E=B.promise();if(tab.FeatureFlags.isEnabled('StoryPointPrefetch')&&(!tsConfig.is_authoring||tab.FeatureFlags.isEnabled('StoryPointCache'))){var F=D+(D-A.get_currentPointIndex());if(F>=0&&F<A.get_flipboardNavPresModel().storypointNavItems.length){var G=A.get_flipboardNavPresModel().storypointNavItems[F].storyPointId;E=E.then(function(){_.defer(function(){n.$j(C,G);});},null);}}return E;};n.$j=function(A,B){if(tab.FlipboardModel.presModelCache.hasStoryPoint(B)){return;}var C=tab.CommandUtils.newCommand$1('get-storypoint',null);var D={};D['storyboard']=tsConfig.current_sheet_name;D['flipboardZoneId']=A.get_zoneId();D['storyPointId']=B;C.commandParams=D;var E=function(G){var H=G;if(ss.isValue(H)&&ss.isValue(H.dashboardPresModel)){tab.FlipboardModel.presModelCache.addStoryPoint(B,H);}};var F=new tab.RemoteClientCommand(C,'none',E,null);tab.CommandController.SendCommand(F);};n.$k=function(A){n.$i(A);};n.$b=function(A,B){var C=tab.CommandUtils.newCommand('revert-story-point',null);C.commandParams={};tab.CommandUtils.addStoryPointToCommand(C.commandParams,A);C.commandParams['storyPointId']=B.toString();return C;};n.$1=function(A){var B=n.$g('capture-story-point',true);B.commandParams['storyPointId']=A.toString();return B;};n.$h=function(A,B,C){if(ss.isValue(B)){var D=B.get_storyPoints()[B.get_currentPointIndex()];var E=C.makeMutablePresModel(B,false);D=E.storypointNavItems[B.get_currentPointIndex()];D.storyPointCaption=A;}};n.$m=function(A,B,C,D){if(ss.isValue(B)){var E=B.get_flipboardNavPresModel();var F=0;var G=false;var H=E.storypointNavItems;for(var I=0,J=H.length;I<J;I++){if(H[I].storyPointId===A){F=I;G=true;break;}}if(G){E=C.makeMutablePresModel(B,false);E.currentStorypointIndex=F;}}if(ss.isValue(D)&&(!tsConfig.is_authoring||tab.FeatureFlags.isEnabled('StoryPointCache'))&&ss.isValue(tab.FlipboardModel.presModelCache)&&tab.FlipboardModel.presModelCache.hasStoryPoint(A)){var K=tab.FlipboardModel.presModelCache.getStoryPoint(A);if(tab.ApplicationModel.get_instance().get_renderMode()!=='render-mode-client'){var L=C.makeMutablePresModel(tab.ApplicationModel.get_instance(),false);L.renderMode='render-mode-client';}var M=C.makeMutablePresModel(D,true);M.activeStoryPointId=A;M.storyPoints[A.toString()]=K;var N=C.makeMutablePresModel(tab.ApplicationModel.get_instance().get_dataDictionary(),false);N.dataSegments={};if(tab.FeatureParamsLookup.getBool(43)){tab.MetricsLogger.get_instance().logEvent(new tabBootstrap.MetricsEvent('gen',8,ss.mkdict(['Story','CacheHit'])));}}else{n.$i(C);}};n.$0=function(A,B){var C=n.$g('set-active-story-point',false);C.commandParams['storyPointId']=A.toString();C.commandParams['shouldAutoCapture']=(B?'true':'false');C.commandParams['shouldAutoRevert']=(B?'false':'true');return C;};n.$7=function(A){var B=n.$g('next-story-point',false);B.commandParams['shouldAutoCapture']=(A?'true':'false');B.commandParams['shouldAutoRevert']=(A?'false':'true');return B;};n.$8=function(A){var B=n.$g('previous-story-point',false);B.commandParams['shouldAutoCapture']=(A?'true':'false');B.commandParams['shouldAutoRevert']=(A?'false':'true');return B;};n.$d=function(A){var B=n.$g('set-flipboard-nav-type',false);B.commandParams['flipboardNavType']=A;return B;};n.$5=function(A,B){var C=n.$g('insert-story-point',false);C.commandParams['currentStorypointIndex']=B;C.commandParams['storyPointBase']=A;return C;};n.$a=function(A,B){var C=n.$g('replace-story-point',false);C.commandParams['storyPointId']=B;C.commandParams['storyPointBase']=A;return C;};n.$9=function(A,B){var C=n.$g('reorder-story-points',false);C.commandParams['storyPointId']=A;C.commandParams['currentStorypointIndex']=B;return C;};n.$2=function(A){var B=n.$g('delete-story-point',true);B.commandParams['storyPointId']=A;return B;};n.$6=function(){return n.$g('new-blank-story-point',false);};n.$3=function(){return n.$g('duplicate-active-story-point',false);};n.$c=function(){return n.$g('save-active-story-point-as-new',false);};n.$e=function(){return n.$g('toggle-storypoints-nav-arrows',true);};n.$4=function(A,B){var C=n.$g('edit-story-point-caption',true);C.commandParams['storyPointCaption']=A;C.commandParams['storyPointId']=B.toString();return C;};n.$g=function(A,B){var C=tab.CommandUtils.newCommand(A,null);var D=tab.ApplicationModel.get_instance().get_workbook().get_storyboard().get_flipboard();var E={};E['storyboard']=tsConfig.current_sheet_name;if(B){E['flipboardZoneId']=D.get_zoneId();}C.commandParams=E;return C;};n.$i=function(A){var B=tab.ApplicationModel.get_instance().get_workbook().get_storyboard().get_flipboard();if(ss.isValue(B)){B.invalidated(A.modelUpdateContext);}};n.$l=function(A,B,C){var D=$.Deferred();var E=new tab.ClientCommand(C,A,B,tab.CommandController.DeferredSuccessHandler(D),tab.CommandController.deferredFailureHandler(D));tab.CommandController.SendCommand(E);return D;};global.tab.StoryClientCommands=n;var o=function(){};o.__typeName='tab.StoryFactory';global.tab.StoryFactory=o;var p=function(){};p.__typeName='tab.StoryHelperFunctions';p.isTableauFontName=function(A){return ss.startsWithString(A.toUpperCase(),'TABLEAU');};p.shouldUseHackForArrowOnlyNavigator=function(A,B){return B==='arrowonly'&&p.isTableauFontName(A);};global.tab.StoryHelperFunctions=p;var q=function(){};q.__typeName='tab.StoryNavigatorContentViewFactory';q.createContentView=function(A){if(A.get_navType()==='dot'){return new s(A);}else if(A.get_navType()==='arrowonly'){var B=A.get_selectedStoryPointStyle().textStyle.fontName;if(p.shouldUseHackForArrowOnlyNavigator(B,A.get_navType())){return new t(A);}else{return new u(A);}}else{return new u(A);}};global.tab.StoryNavigatorContentViewFactory=q;var r=function(A){r.$ctor1.call(this,A,q.createContentView(A));};r.__typeName='tab.StoryNavigatorPointView';r.$ctor1=function(A,B){this.$o=null;this.$q=null;this.$s=null;this.$r=null;this.$p=null;ss.makeGenericType(spiff.BaseView$1,[x]).call(this,A,new w());this.get_storyPointCaptionViewModel().add_updatePoint(ss.mkdel(this,this.$d));this.get_storyPointCaptionViewModel().add_flipboardNavTypeChanged(ss.mkdel(this,this.$c));this.get_storyPointCaptionViewModel().set_findCaptionDom(ss.mkdel(this,function(){return this.get_captionTemplate().caption;}));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.get_storyPointCaptionViewModel().remove_updatePoint(ss.mkdel(this,this.$d));this.get_storyPointCaptionViewModel().remove_flipboardNavTypeChanged(ss.mkdel(this,this.$c));this.get_storyPointCaptionViewModel().set_findCaptionDom(null);})));this.$o=B;this.$i();this.$g();this.$j();};global.tab.StoryNavigatorPointView=r;var s=function(A){ss.makeGenericType(spiff.BaseView$1,[x]).call(this,A,new v());};s.__typeName='tab.StoryNavigatorShapeView';global.tab.StoryNavigatorShapeView=s;var t=function(A){u.call(this,A);};t.__typeName='tab.StoryNavigatorTableauFontVerticalCenteringHackView';global.tab.StoryNavigatorTableauFontVerticalCenteringHackView=t;var u=function(A){this.scrollableViewModel=null;this.scrollableView=null;ss.makeGenericType(spiff.BaseView$1,[x]).call(this,A,new v());};u.__typeName='tab.StoryNavigatorTextView';global.tab.StoryNavigatorTextView=u;var v=function(){spiff.Template.call(this,$("<div class='tabStoryPointContent'/>"));};v.__typeName='tab.StoryPointCaptionContentTemplate';global.tab.StoryPointCaptionContentTemplate=v;var w=function(){this.caption=null;this.revert=null;this.update=null;this.updateTextButton=null;this.updateIconButton=null;this.delete$1=null;this.captionTop=null;this.captionBottom=null;this.toolbar=null;spiff.Template.call(this,$("<span class='tabStoryPoint'>\n<div class='tabStoryPointToolbar'>\n  <div class='tabStoryRevert'></div>  <div class='tabStoryUpdate'><div class='tabStoryUpdateTextButton'></div><div class='tabStoryUpdateIconButton'></div></div>\n  <div class='tabStoryDelete'></div></div>\n<div class='tabStoryPointCaption'><div class='tabStoryPointCaptionTop'/><div class='tabStoryPointCaptionBottom'/></div></span>"));this.caption=this.getElementBySelector('.tabStoryPointCaption');this.revert=this.getElementBySelector('.tabStoryRevert');this.toolbar=this.getElementBySelector('.tabStoryPointToolbar');if(!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){this.update=this.getElementBySelector('.tabStoryUpdate');this.updateIconButton=this.getElementBySelector('.tabStoryUpdateIconButton');this.updateTextButton=this.getElementBySelector('.tabStoryUpdateTextButton');this.delete$1=this.getElementBySelector('.tabStoryDelete');}this.captionTop=this.getElementBySelector('.tabStoryPointCaptionTop');this.captionBottom=this.getElementBySelector('.tabStoryPointCaptionBottom');};w.__typeName='tab.StoryPointCaptionTemplate';global.tab.StoryPointCaptionTemplate=w;var x=function(A,B){this.$6=null;this.$7=0;this.$4=null;this.$5=null;this.$2$1=null;this.$2$2=null;this.$2$3=null;this.$2$4=null;this.$2$5=null;this.$2$6=null;this.$2$7=null;this.$2$8=null;this.isCenteredHorizontally=false;this.isCenteredVertically=false;spiff.BaseViewModel.call(this);this.$6=A;this.$7=B;this.$6.add_newFlipboardNav(ss.mkdel(this,this.handleNewFlipboardNav));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$6.remove_newFlipboardNav(ss.mkdel(this,this.handleNewFlipboardNav));})));if(this.$6.get_navType()==='number'||this.$6.get_navType()==='arrowonly'){this.isCenteredHorizontally=true;this.isCenteredVertically=true;}};x.__typeName='tab.StoryPointViewModel';global.tab.StoryPointViewModel=x;var y=function(){};y.__typeName='tab.StoryUIEvents';y.$2=function(A){y.$1$1=ss.delegateCombine(y.$1$1,A);};y.$3=function(A){y.$1$1=ss.delegateRemove(y.$1$1,A);};y.$4=function(A){y.$1$2=ss.delegateCombine(y.$1$2,A);};y.$5=function(A){y.$1$2=ss.delegateRemove(y.$1$2,A);};y.$0=function(){if(!ss.staticEquals(y.$1$1,null)){y.$1$1();}};y.$1=function(A){if(!ss.staticEquals(y.$1$2,null)){y.$1$2(A);}};global.tab.StoryUIEvents=y;var z=function(){this.$1$1=0;this.$1$2=0;};z.__typeName='tab.ViewingUberPopupContainer';global.tab.ViewingUberPopupContainer=z;ss.initClass(b,a,{});ss.initClass(c,a,{},spiff.Template,[ss.IDisposable]);ss.initClass(d,a,{},spiff.Template,[ss.IDisposable]);ss.initInterface(j,a,{get_dom:null,get_domRoot:null},[ss.IDisposable,tab.IAppendableView,ss.makeGenericType(tab.IView$1,[f])]);ss.initClass(e,a,{get_domRoot:function(){return this.get_template().domRoot;},get_flipboardNavViewModel:function(){return this.get_viewModel();},get_storyPointCaptionViewModel:function(){return ss.getItem(this.get_flipboardNavViewModel().get_captions(),0);},get_dom:function(){return ss.cast(this.get_template(),d);},get_scrollingView:function(){return this.$n;},$l:function(){var A=((this.get_flipboardNavViewModel().get_navType()==='arrowonly')?0:this.get_flipboardNavViewModel().get_currentPointIndex());return this.$m.points.children().get(A);},$b:function(){this.$m=new c();this.$o=new spiff.ScrollableViewModel.$ctor1(false);this.$o.set_content(this.$m.domRoot[0]);this.$o.set_scrollX(true);this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){tab.StyleUtil.clearStyleSheet('flipboardNavScroller');this.$o.dispose();})));},$k:function(){if(this.get_flipboardNavViewModel().get_useDarkIcons()){this.get_domRoot().addClass('tabDarkIcons');}else{this.get_domRoot().addClass('tabLightIcons');}var A=this.get_flipboardNavViewModel().get_scrollBarStyle();if(ss.isValue(A)){tab.StyleUtil.appendCSSRuleToStyleSheet$1('flipboardNavScroller','.tabFlipboardNavScroller .iScrollHorizontalScrollbar',{'background-color':A.bgRestColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('flipboardNavScroller','.tabFlipboardNavScroller .iScrollHorizontalScrollbar:hover',ss.mkdict(['background-color',A.bgActiveColor]));tab.StyleUtil.appendCSSRuleToStyleSheet$1('flipboardNavScroller','.tabFlipboardNavScroller .iScrollHorizontalScrollbar>.iScrollIndicator',{'background-color':A.defaultColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('flipboardNavScroller','.tabFlipboardNavScroller .iScrollHorizontalScrollbar>.iScrollIndicator:hover',{'background-color':A.color});}},$f:function(){var A=new spiff.Button(this.get_dom().previous);var B=ss.mkdel(this,function(){this.get_flipboardNavViewModel().clickPrevious();});A.add_click(B);this.disposables.add$1(A);this.disposables.add$1(new tab.CallOnDispose(function(){A.remove_click(B);}));var C=new spiff.Button(this.get_dom().next);var D=ss.mkdel(this,function(){this.get_flipboardNavViewModel().clickNext();});C.add_click(D);this.disposables.add$1(C);this.disposables.add$1(new tab.CallOnDispose(function(){C.remove_click(D);}));},onAddedToDom:function(){spiff.Widget.prototype.onAddedToDom.call(this);this.$n=spiff.ScrollableView.createScrollableView(this.$o);this.$n.addToDom(this.get_dom().scroller);this.$c();},$c:function(){this.get_dom().previous.toggle(this.get_flipboardNavViewModel().get_showArrows());this.get_dom().next.toggle(this.get_flipboardNavViewModel().get_showArrows());var A=this.get_dom().previous.add(this.get_dom().next);var B;var C=this.get_flipboardNavViewModel().get_storyPointHeight();B=C+20;var D;if(this.get_flipboardNavViewModel().get_navType()==='number'||this.get_flipboardNavViewModel().get_navType()==='arrowonly'||this.get_flipboardNavViewModel().get_navType()==='dot'){D='scale(.75, .7)';}else{D='scale(.875, .8125)';}this.$d();A.css(ss.mkdict(['transform',D]));var E=tab.DoubleUtil.roundToInt(this.get_dom().previousArrow.height());var F=ss.Int32.div(C-E,2);F-=3;var G;if(F<0){G=ss.mkdict(['padding-top','0px','padding-bottom','0px','margin-bottom',this.$n.get_scrollbarBuffer()+F+'px']);}else{G=ss.mkdict(['padding-top',F+'px','padding-bottom',F+'px','margin-bottom',this.$n.get_scrollbarBuffer()+'px']);}A.css(G);this.$i();if(ss.isValue(B)){this.get_dom().scroller.css('height',B+this.$n.get_scrollbarBuffer()+'px');}this.$e();this.centerNav();this.handleUpdateActivePoint();},$d:function(){var A=this.get_dom().previous.add(this.get_dom().next);A.removeClass('ArrowLarge');A.removeClass('ArrowSmall');if(this.get_flipboardNavViewModel().get_navType()==='caption'){A.addClass('ArrowLarge');}else if(this.get_flipboardNavViewModel().get_navType()==='number'||this.get_flipboardNavViewModel().get_navType()==='arrowonly'||this.get_flipboardNavViewModel().get_navType()==='dot'){A.addClass('ArrowSmall');}},$i:function(){if(ss.isNullOrUndefined(this.get_storyPointCaptionViewModel())){return;}var A={};var B={};var C={};var D={};var E={};if(ss.isValue(this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle())){A=this.$g(this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle());C=this.$j(this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle());E=this.$h();}if(ss.isValue(this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle())){B=this.$g(this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle());D=this.$j(this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle());if(Object.keys(E).length<=0){E=this.$h();}}tab.StyleUtil.clearStyleSheet('appendedStoryStyle');tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabFlipboardNavScroller .tabScroller .tabScrollerContent .tabFlipboardNavPoints .tabStoryPoint',E);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent',A);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption',B);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabScrollerContentWindow .tabScrollerContent .tabStoryPointContent',C);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabCustomScroller .tabScrollerContentWindow .tabScrollerContent .tabStoryPointContent',D);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabStoryPointCaptionTop,.tabStoryPointCaption.tabCurrent .tabStoryPointCaptionBottom',A);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabStoryPointCaptionTop,.tabStoryPointCaption .tabStoryPointCaptionBottom',B);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabScroller .tabScrollerContent .tabStoryPointContent',C);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabScroller .tabScrollerContent .tabStoryPointContent',D);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar',{'background-color':this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle().scrollBarStyle.bgRestColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar',{'background-color':this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle().scrollBarStyle.bgRestColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator',{'background-color':this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle().scrollBarStyle.defaultColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator',{'background-color':this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle().scrollBarStyle.defaultColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator:hover',{'background-color':this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle().scrollBarStyle.color});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator:hover',{'background-color':this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle().scrollBarStyle.color});},$g:function(A){var B=false;if(ss.isValue(A.styledBox)){return tab.FormattingConverters.makeStyledBoxCssDict(A.styledBox,B);}else{return {};}},$j:function(A){if(ss.isValue(A.textStyle)){return tab.FormattingConverters.makeFormatStyleDict(A.textStyle,null);}else{return {};}},$h:function(){var A=150;var B=70;var C={};var D=B,E=A;if(ss.isValue(this.get_viewModel().get_storyPointHeight())){D=this.get_viewModel().get_storyPointHeight();}C.height=D+20+'px';if(ss.isValue(this.get_viewModel().get_storyPointWidth())){E=this.get_viewModel().get_storyPointWidth();}C.width=E+'px';return C;},centerNav:function(){var A=this.$m.points[0].clientWidth+this.$9();var B=tab.DoubleUtil.roundToInt(this.get_dom().domRoot.parent().width());var C=0;if(B>A){C=ss.Int32.div(B-A,2);}this.get_dom().domRoot.css('margin-left',C+'px');var D=tab.DoubleUtil.roundToInt(this.get_domRoot().height());D-=2;var E=ss.Int32.div(D,2);this.get_dom().domRoot.css('margin-top','-'+E+'px');},handleResize:function(){var A=tab.DoubleUtil.roundToInt(this.get_dom().domRoot.parent().width())-this.$9();var B=this.$m.points[0].clientWidth;this.get_dom().scroller.css(ss.mkdict(['width',Math.min(A,B)+'px']));this.centerNav();this.$o.triggerRefresh();},$a:function(){this.get_viewModel().closeUberMenu();},$9:function(){return (this.get_flipboardNavViewModel().get_showArrows()?(tab.DoubleUtil.roundToInt(this.get_dom().previous.outerWidth(true))+tab.DoubleUtil.roundToInt(this.get_dom().next.outerWidth(true))):0);},handleUpdateActivePoint:function(){this.$e();var A=this.$l();var B=A.offsetLeft;var C=B+A.offsetWidth;var D=this.$n.get_scrollerX();var E=D+tab.DoubleUtil.roundToInt(this.get_dom().scroller.width());var F=50;if(C>E){var G=tab.DoubleUtil.roundToInt(this.get_dom().scroller.width())-A.offsetWidth-F;this.$n.scrollToElement(A,0,-G,0);}else if(B<D){this.$n.scrollToElement(A,0,-50,0);}this.get_dom().previous.toggleClass('tabDisabled',this.get_flipboardNavViewModel().get_previousDisabled());this.get_dom().next.toggleClass('tabDisabled',this.get_flipboardNavViewModel().get_nextDisabled());},$e:function(){var A=this.get_template().getElementsBySelector('.tabStoryPoint');A.remove();var B=ss.getEnumerator(this.get_flipboardNavViewModel().get_captions());try{while(B.moveNext()){var C=B.current();if(C.get_shouldBeAdded()){var D=tab.ObjectRegistry.newView(l).call(null,[C]);D.addToDom(this.$m.points);}}}finally{B.dispose();}this.handleResize();}},ss.makeGenericType(spiff.BaseView$1,[f]),[tab.IWidget,tab.IAppendableView,ss.IDisposable,ss.makeGenericType(tab.IView$1,[f]),j]);ss.initClass(f,a,{add_resizeZone:function(A){this.$2$1=ss.delegateCombine(this.$2$1,A);},remove_resizeZone:function(A){this.$2$1=ss.delegateRemove(this.$2$1,A);},add_updateActivePoint:function(A){this.$2$2=ss.delegateCombine(this.$2$2,A);},remove_updateActivePoint:function(A){this.$2$2=ss.delegateRemove(this.$2$2,A);},add_remoteUpdateComplete:function(A){this.$2$3=ss.delegateCombine(this.$2$3,A);},remove_remoteUpdateComplete:function(A){this.$2$3=ss.delegateRemove(this.$2$3,A);},get_currentPointIndex:function(){return this.$d.get_currentPointIndex();},get_numberOfPoints:function(){return this.$d.get_storyPoints().length;},get_storyPointHeight:function(){return this.$d.get_height();},get_storyPointWidth:function(){return this.$d.get_width();},get_previousDisabled:function(){return this.get_currentPointIndex()<=0;},get_nextDisabled:function(){return this.get_currentPointIndex()>=this.get_numberOfPoints()-1;},get_showArrows:function(){return this.$d.get_flipboardNavPresModel().navArrowsVisible;},get_captions:function(){return this.$a;},get_useDarkIcons:function(){return this.$d.get_flipboardNavPresModel().flipboardNavStyle.useDarkIcons;},get_scrollBarStyle:function(){return this.$d.get_flipboardNavPresModel().flipboardNavStyle.scrollBarStyle;},get_navType:function(){return this.$d.get_navType();},get_currentStoryPointId:function(){return (ss.isValue(this.$d)?this.$d.get_storyPoints()[this.get_currentPointIndex()].storyPointId:0);},handleNewFlipboardNav:function(){if(ss.isValue(this.$2$2)){this.updatePoints();this.$2$2();}if(!this.$c){var A=tab.CommandController.get();var B=null;B=ss.mkdel(this,function(){A.remove_commandQueueComplete(B);this.$c=false;this.raiseActionEvent(this.$2$3);this.$5();this.$e.updatePoints(this.$a,this.get_currentStoryPointId());});A.add_commandQueueComplete(B);this.$c=true;}},handlePointWasCaptured:function(A){var B=((this.get_navType()==='arrowonly')?this.get_currentStoryPointId():A);this.$b.push(B);},handleNavArrowVisibilityChanged:function(){this.closeUberMenu();},updatePoints:function(){this.$7();this.$2();},$5:function(){for(var A=0;A<this.$b.length;A++){var B=this.$b[A];this.$6(B);}},$6:function(A){var B=b.getViewModelFromStoryId(this.$a,A);if(ss.isValue(B)){B.notifyPointWasCaptured();}},$4:function(){this.closeUberMenu();this.raiseActionEvent(this.$2$1);},$7:function(){for(var A=0;A<this.$a.length;A++){var B=this.$a[A];B.remove_pointUpdatedShown(ss.mkdel(this,this.clearUpdatedPoint));B.remove_showUberMenuForPoint(ss.mkdel(this,this.showUberMenu));B.remove_hideUberMenuForPoint(ss.mkdel(this,this.hideUberMenu));B.remove_closeUberMenu(ss.mkdel(this,this.closeUberMenu));B.remove_showUpdatedToastOnReload(ss.mkdel(this,this.handlePointWasCaptured));B.dispose();}ss.clear(this.$a);},$2:function(){for(var A=0;A<this.get_numberOfPoints();A++){var B=new x(this.$d,A);B.add_pointUpdatedShown(ss.mkdel(this,this.clearUpdatedPoint));B.add_showUberMenuForPoint(ss.mkdel(this,this.showUberMenu));B.add_hideUberMenuForPoint(ss.mkdel(this,this.hideUberMenu));B.add_closeUberMenu(ss.mkdel(this,this.closeUberMenu));B.add_showUpdatedToastOnReload(ss.mkdel(this,this.handlePointWasCaptured));this.$a.push(B);}},clearUpdatedPoint:function(A){ss.remove(this.$b,A);},showUberMenu:function(A){this.$e.showUber(A);},hideUberMenu:function(A){this.$e.hideUberWithTimeoutAndFade();},hideUberMenuImmediately:function(){this.$e.hideUberWithFade();},$9:function(){this.$e.updatePoints(this.$a,this.get_currentStoryPointId());},closeUberMenu:function(){this.$e.close();},clickNext:function(){return this.$3(n.nextStoryPoint,this.get_nextDisabled());},clickPrevious:function(){return this.$3(n.previousStoryPoint,this.get_previousDisabled());},$3:function(A,B){var C=$.Deferred();if(B){C.resolve(this.get_currentPointIndex());}else{this.$8(C,ss.mkdel(this,function(){return A(this.$d);}));}this.closeUberMenu();return C.promise();},dispose:function(){this.$7();spiff.BaseViewModel.prototype.dispose.call(this);},$8:function(A,B){var C=ss.mkdel(this,function(){A.resolve(this.get_currentPointIndex());});var D=function(){A.reject(ss.unbox(ss.cast(arguments[0],ss.Int32)));};B().then(C,D);}},spiff.BaseViewModel,[ss.IDisposable,tab.IViewModel,tab.IFlipboardNavigatorViewModel]);ss.initClass(g,a,{},spiff.Template,[ss.IDisposable]);ss.initClass(h,a,{onAddedToDom:function(){spiff.Widget.prototype.onAddedToDom.call(this);if(ss.isValue(this.$a.get_dashboardViewModel())){this.handleNewStoryPoint();}},handleNewStoryPoint:function(){var A={w:tab.DoubleUtil.roundToInt(this.element.width()),h:tab.DoubleUtil.roundToInt(this.element.height())};this.$a.get_dashboardViewModel().set_size(h.$0(tab.RecordCast.sizeAsSizePresModel(A),this.$a.get_dashboardViewModel().get_size()));this.$9();var B=tab.ObjectRegistry.newView(tab.DashboardView).call(null,[this.$a.get_dashboardViewModel()]);B.addToDom(this.get_template().domRoot);},handleResizeZone:function(){var A={w:this.$a.get_parentZone().get_contentWidth(),h:this.$a.get_parentZone().get_contentHeight()};this.$a.get_dashboardViewModel().set_size(h.$0(tab.RecordCast.sizeAsSizePresModel(A),this.$a.get_dashboardViewModel().dashboardModel.get_dashboardSize()));this.$9();},$9:function(){var A=this.$a.get_parentZone().get_contentWidth();var B=this.$a.get_parentZone().get_contentHeight();var C=this.$a.get_dashboardViewModel().dashboardModel.get_dashboardSize();if(C.w<=A&&C.h<=B+3){this.element.css('overflow','hidden');}else{this.element.css('overflow','auto');}}},ss.makeGenericType(spiff.BaseView$1,[i]),[tab.IWidget,tab.IAppendableView,ss.IDisposable,ss.makeGenericType(tab.IView$1,[i])]);ss.initClass(i,a,{add_newStoryPoint:function(A){this.$2$1=ss.delegateCombine(this.$2$1,A);},remove_newStoryPoint:function(A){this.$2$1=ss.delegateRemove(this.$2$1,A);},get_flipboardModel:function(){return this.$7;},get_dashboardViewModel:function(){return this.$6;},$5:function(){return this.get_flipboardModel().get_dashboardModel().pm;},get_parentZone:function(){return this.$8;},$3:function(){this.$2();if(ss.isValue(this.$5())){this.$6=tab.DashboardViewModel.new$1(this.get_flipboardModel().get_dashboardModel());this.raiseActionEvent(this.$2$1);}tab.Application.handleAllFontsFound();},$4:function(){this.$8.forceZoneValidState(false);},dispose:function(){this.$2();spiff.BaseViewModel.prototype.dispose.call(this);},$2:function(){if(ss.isValue(this.get_dashboardViewModel())){this.$6.dispose();this.$6=null;}}},spiff.BaseViewModel,[ss.IDisposable,tab.IViewModel,tab.IFlipboardViewModel]);ss.initInterface(k,a,{get_rootTemplate:null,styleCaption:null,handleUpdatePoint:null,setupContent:null},[ss.IDisposable,tab.IAppendableView,ss.makeGenericType(tab.IView$1,[x])]);ss.initInterface(l,a,{get_contentTemplate:null,get_captionTemplate:null},[ss.IDisposable,tab.IAppendableView,ss.makeGenericType(tab.IView$1,[x])]);ss.initInterface(m,a,{get_isShowing:null,get_isShowingWithHide:null,get_targetStoryPointId:null,get_timeoutMs:null,set_timeoutMs:null,get_fadeMs:null,set_fadeMs:null,updatePoints:null,showUber:null,hideUberWithTimeoutAndFade:null,hideUberWithFade:null,showUberWithTimeoutAndFade:null,close:null},[ss.IDisposable]);ss.initClass(n,a,{});ss.initClass(o,a,{newFlipboardNavigatorViewModel:function(A){return new f(A);},newFlipboardViewModel:function(A,B){return new i(A,B);},newFlipboardNavigatorView:function(A){return tab.ObjectRegistry.newView(j).call(null,[A]);},newFlipboardView:function(A){return tab.ObjectRegistry.newView(h).call(null,[A]);},insertStoryPoint:function(A,B){return n.insertStoryPoint(A,B);},replaceStoryPoint:function(A,B){return n.replaceStoryPoint(A,B);},fireCloseStoryUberMenu:function(){y.$0();},fireShowUpdateToast:function(A){y.$1(A);}},null,[tab.IStoryModule]);ss.initClass(p,a,{});ss.initClass(q,a,{});ss.initClass(r,a,{get_domRoot:function(){return this.get_template().domRoot;},get_contentTemplate:function(){return ss.cast(this.$o.get_rootTemplate(),v);},get_storyPointCaptionViewModel:function(){return this.get_viewModel();},get_captionTemplate:function(){return ss.cast(this.get_template(),w);},onAddedToDom:function(){spiff.Widget.prototype.onAddedToDom.call(this);this.$c();},$c:function(){this.$o.addToDom(this.get_captionTemplate().caption);this.$o.styleCaption(this.get_captionTemplate());this.$d();if(tsConfig.is_authoring){this.$n();}},$i:function(){if(this.get_storyPointCaptionViewModel().get_isFirstPoint()){this.get_domRoot().addClass('tabFirstPoint');}if(this.get_storyPointCaptionViewModel().get_isLastPoint()){this.get_domRoot().addClass('tabLastPoint');}},$d:function(){if(tsConfig.is_authoring&&!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){if(this.get_viewModel().get_width()<this.$q.element.width()+this.$s.element.width()+this.$p.element.width()+12){this.$r.element.addClass('small');this.$q.element.addClass('small');this.$p.element.addClass('small');if(this.get_viewModel().get_navType()!=='caption'){this.$9();}else{this.$e();}this.get_captionTemplate().updateIconButton.show();this.get_captionTemplate().updateTextButton.hide();this.get_captionTemplate().delete$1.toggle(this.get_storyPointCaptionViewModel().get_isCaptured()&&!this.get_viewModel().get_isStoryEmpty());}else{this.$r.element.removeClass('small');this.$q.element.removeClass('small');this.$p.element.removeClass('small');this.get_captionTemplate().update.append(this.$s.element);this.get_captionTemplate().updateIconButton.hide();this.get_captionTemplate().updateTextButton.show();this.get_captionTemplate().delete$1.toggle(!this.get_viewModel().get_isStoryEmpty());}this.get_captionTemplate().update.toggle(!this.get_storyPointCaptionViewModel().get_isCaptured());}else{if(!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){this.get_captionTemplate().update.hide();}if(this.get_viewModel().get_navType()!=='caption'){this.$9();}}if(tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')&&tsConfig.is_authoring){this.get_captionTemplate().revert.hide();}else{this.get_captionTemplate().revert.toggle(!this.get_storyPointCaptionViewModel().get_isCaptured());}this.get_captionTemplate().caption.toggleClass('tabCurrent',this.get_storyPointCaptionViewModel().get_isCurrentPoint());this.$o.handleUpdatePoint();},$9:function(){var A=this.get_captionTemplate().revert.find('.tab-iconButton');var B=A.width();if(!tsConfig.is_authoring){var C=(this.get_viewModel().get_width()-B)/2;A.css('left',C+'px');}else if(tsConfig.is_authoring&&!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){var D=this.get_captionTemplate().update.find('.tab-iconButton');var E=D.width();var F=(this.get_viewModel().get_width()-B-E-4)/2;var G=F+A.width()+4;A.css('left',F+'px');D.css('left',G+'px');}},$e:function(){if(!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){var A=this.get_captionTemplate().revert.find('.tab-iconButton');var B=this.get_captionTemplate().update.find('.tab-iconButton');var C=A.width()+4;B.css('left',C+'px');}},$n:function(){if(!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){this.$p.element.removeClass('tabDeleteIconCaption');this.$p.element.removeClass('tabDeleteIconNumber');this.$p.element.removeClass('tabDeleteIconDot');switch(this.get_viewModel().get_navType()){case 'caption':{this.$p.element.addClass('tabDeleteIconCaption');this.$p.element.css('margin','auto');break;}case 'number':{this.$p.element.addClass('tabDeleteIconNumber');this.$p.element.css('margin','auto');break;}case 'dot':{this.$p.element.addClass('tabDeleteIconDot');var A=this.get_storyPointCaptionViewModel().get_width();var B=this.$p.element.width();var C=(A-B)/2;this.$p.element.css('margin','auto '+C+'px auto '+C+'px');break;}case 'arrowonly':{break;}default:{break;}}}},$j:function(){this.$f();this.$l();if(tsConfig.is_authoring&&!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){this.$m();this.$h();}this.$k();},$k:function(){var A={};spiff.EventHandleSpecExtensions.setHandler(A,'hover',ss.mkdel(this,this.$a));spiff.EventHandleSpecExtensions.setHandler(A,'mouseleave',ss.mkdel(this,this.$b));this.disposables.add$1(new spiff.TableauEventHandler.$ctor1(this.get_captionTemplate().caption[0],A));},$a:function(){this.get_viewModel().showUberMenu();},$b:function(){this.get_viewModel().hideUberMenu();},$l:function(){this.get_captionTemplate().revert.attr('title',tab.Strings.StoryPointRevertTooltip);this.$q=new spiff.IconButton();this.$q.setIcon('tabStoryRevertSmallIcon');this.get_captionTemplate().revert.append(this.$q.element);this.disposables.add$1(this.$q.onClick(ss.mkdel(this,function(A){this.get_storyPointCaptionViewModel().revertStoryPoint();})));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$q.dispose();})));},$m:function(){if(!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){var A=ss.mkdel(this,function(){this.get_viewModel().captureStoryPoint();});this.$s=spiff.StyledTextButton.createUnificationLabelButton(A,tab.Strings.StoryPointUpdateButton,'tabStoryUpdateButton',3,null);this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$s.remove_click(A);})));this.$r=new spiff.IconButton();this.$r.setIcon('tabStoryUpdateSmallIcon');this.get_captionTemplate().update.attr('title',tab.Strings.StoryPointUpdateButton);this.disposables.add$1(this.$r.onClick(ss.mkdel(this,function(B){this.get_viewModel().captureStoryPoint();})));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$s.dispose();this.$r.dispose();})));this.get_captionTemplate().updateIconButton.append(this.$r.element);this.get_captionTemplate().updateTextButton.append(this.$s.element);}},$h:function(){if(!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){this.get_captionTemplate().delete$1.attr('title',tab.Strings.StoryPointDeleteTooltip);this.$p=new spiff.IconButton();this.$p.setIcon('tabStoryDeleteSmallIcon');this.get_captionTemplate().delete$1.append(this.$p.element);this.disposables.add$1(this.$p.onClick(ss.mkdel(this,function(A){this.get_storyPointCaptionViewModel().deleteStoryPoint();})));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$p.dispose();})));this.$n();}},$f:function(){this.disposables.add$1((new spiff.ClickHandler()).setTarget(this.get_captionTemplate().caption).onClick(ss.mkdel(this,function(A){A.stopPropagation();this.get_storyPointCaptionViewModel().clickStoryPoint();})));},$g:function(){this.$o.setupContent();}},ss.makeGenericType(spiff.BaseView$1,[x]),[tab.IWidget,tab.IAppendableView,ss.IDisposable,ss.makeGenericType(tab.IView$1,[x]),l]);r.$ctor1.prototype=r.prototype;ss.initClass(s,a,{get_rootTemplate:function(){return this.get_template();},handleUpdatePoint:function(){},styleCaption:function(A){A.domRoot.addClass('tabFormatted');if(tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){A.domRoot.addClass(s.storyPointDotClassName);}A.caption.addClass(s.circleClassName);A.captionBottom.hide();A.captionTop.hide();var B=Math.floor(this.get_viewModel().get_width()*s.dotsScale);var C=Math.floor(this.get_viewModel().get_height()*s.dotsScale);A.caption.width(B+'px');A.caption.height(C+'px');var D=ss.round(A.caption.outerWidth()-A.caption.innerWidth());var E=this.get_viewModel().get_width()-B-D;var F=this.get_viewModel().get_height()-C;E=Math.max(ss.Int32.div(E,2),0);F=Math.max(ss.Int32.div(F,2),0);A.caption.css('left',E+'px');A.caption.css('top',F+ss.round(A.toolbar.outerHeight())+'px');},setupContent:function(){this.get_template().domRoot.text('');}},ss.makeGenericType(spiff.BaseView$1,[x]),[tab.IWidget,tab.IAppendableView,ss.IDisposable,ss.makeGenericType(tab.IView$1,[x]),k]);ss.initClass(u,a,{get_rootTemplate:function(){return this.get_template();},addToDom:function(A){spiff.Widget.prototype.addToDom.call(this,A);this.scrollableView=spiff.ScrollableView.createScrollableView(this.scrollableViewModel);this.scrollableView.addToDom(A);},styleCaption:function(A){if(this.scrollableViewModel.get_hasCustomIndicator()){A.domRoot.addClass('tabFormatted');A.captionBottom.remove();A.captionTop.remove();}var B=ss.mkdict(['right',this.scrollableView.get_scrollbarBuffer()+'px']);A.captionTop.css(B);A.captionBottom.css(B);},handleUpdatePoint:function(){this.scrollableViewModel.triggerRefresh();},setupContent:function(){this.constructStoryPointCaptionContentTemplate(this.get_viewModel());var A=new spiff.ScrollableViewModel();A.set_content(this.get_template().domRoot[0]);A.isCenteredVertically=this.get_viewModel().isCenteredVertically;A.set_scrollY(this.get_viewModel().get_navType()!=='number'&&this.get_viewModel().get_navType()!=='arrowonly');A.set_scrollX(false);this.scrollableViewModel=A;this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.scrollableViewModel.dispose();})));},constructStoryPointCaptionContentTemplate:function(A){if(A.isCenteredHorizontally){this.get_template().domRoot.addClass('centered');}var B=((ss.isNullOrEmptyString(A.get_caption())&&tsConfig.is_authoring)?tab.Strings.StoryEmptyCaptionText:A.get_caption());this.get_template().domRoot.text(B);}},ss.makeGenericType(spiff.BaseView$1,[x]),[tab.IWidget,tab.IAppendableView,ss.IDisposable,ss.makeGenericType(tab.IView$1,[x]),k]);ss.initClass(t,a,{setupContent:function(){this.constructStoryPointCaptionContentTemplate(this.get_viewModel());var A=new spiff.ScrollableViewModel();A.set_content(this.get_template().domRoot[0]);A.isCenteredVertically=true;A.set_scrollY(false);A.set_scrollX(false);this.scrollableViewModel=A;var B=this.get_viewModel().get_selectedStoryPointStyle().textStyle.fontSize;if(B>14){this.scrollableViewModel.get_content().style.marginTop='-9%';}else{var C=-(0.467700004577637*B-0.5);this.scrollableViewModel.get_content().style.marginTop=C+'%';}this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.scrollableViewModel.dispose();})));}},u,[tab.IWidget,tab.IAppendableView,ss.IDisposable,ss.makeGenericType(tab.IView$1,[x]),k]);ss.initClass(v,a,{},spiff.Template,[ss.IDisposable]);ss.initClass(w,a,{},spiff.Template,[ss.IDisposable]);ss.initClass(x,a,{add_updatePoint:function(A){this.$2$1=ss.delegateCombine(this.$2$1,A);},remove_updatePoint:function(A){this.$2$1=ss.delegateRemove(this.$2$1,A);},add_flipboardNavTypeChanged:function(A){this.$2$2=ss.delegateCombine(this.$2$2,A);},remove_flipboardNavTypeChanged:function(A){this.$2$2=ss.delegateRemove(this.$2$2,A);},add_pointCaptured:function(A){this.$2$3=ss.delegateCombine(this.$2$3,A);},remove_pointCaptured:function(A){this.$2$3=ss.delegateRemove(this.$2$3,A);},add_pointUpdatedShown:function(A){this.$2$4=ss.delegateCombine(this.$2$4,A);},remove_pointUpdatedShown:function(A){this.$2$4=ss.delegateRemove(this.$2$4,A);},add_showUberMenuForPoint:function(A){this.$2$5=ss.delegateCombine(this.$2$5,A);},remove_showUberMenuForPoint:function(A){this.$2$5=ss.delegateRemove(this.$2$5,A);},add_hideUberMenuForPoint:function(A){this.$2$6=ss.delegateCombine(this.$2$6,A);},remove_hideUberMenuForPoint:function(A){this.$2$6=ss.delegateRemove(this.$2$6,A);},add_closeUberMenu:function(A){this.$2$7=ss.delegateCombine(this.$2$7,A);},remove_closeUberMenu:function(A){this.$2$7=ss.delegateRemove(this.$2$7,A);},add_showUpdatedToastOnReload:function(A){this.$2$8=ss.delegateCombine(this.$2$8,A);},remove_showUpdatedToastOnReload:function(A){this.$2$8=ss.delegateRemove(this.$2$8,A);},$3:function(){return this.$6.get_storyPoints()[this.$7];},get_isCurrentPoint:function(){return this.$7===this.$6.get_currentPointIndex();},get_isCaptured:function(){return this.$3().isCaptured;},get_caption:function(){return this.$3().storyPointCaption;},get_storyPointId:function(){return this.$3().storyPointId;},get_storyPointIndex:function(){return this.$7;},get_isFirstPoint:function(){return this.get_storyPointIndex()===0;},get_isLastPoint:function(){return this.$7===this.$6.get_storyPoints().length-1;},get_storyPointStyle:function(){if(this.get_isCurrentPoint()){return this.get_selectedStoryPointStyle();}else{return this.get_unselectedStoryPointStyle();}},get_selectedStoryPointStyle:function(){return this.$6.get_flipboardNavPresModel().selectedStoryPointStyle;},get_unselectedStoryPointStyle:function(){return this.$6.get_flipboardNavPresModel().unselectedStoryPointStyle;},get_width:function(){return this.$6.get_width();},get_height:function(){return this.$6.get_height();},get_navType:function(){return this.$6.get_navType();},get_isStoryEmpty:function(){return this.$6.get_isStoryEmpty();},get_findCaptionDom:function(){if(ss.staticEquals(this.$5,null)){this.$5=function(){return null;};}return this.$5;},set_findCaptionDom:function(A){this.$5=A;},get_shouldBeAdded:function(){return this.get_navType()==='arrowonly'&&this.get_isCurrentPoint()||this.get_navType()!=='arrowonly';},handleNewFlipboardNav:function(){var A=this.get_navType()!==this.$4;if(A){this.raiseActionEvent(this.$2$2);}else{this.raiseActionEvent(this.$2$1);}this.$4=this.get_navType();},notifyPointWasCaptured:function(){this.raiseActionEvent(this.$2$3);},notifyPointUpdatedWasShown:function(){this.raiseActionEvent$1(ss.Int32).call(this,this.$2$4,this.get_storyPointId());},showUberMenu:function(){this.raiseActionEvent$1(ss.Int32).call(this,this.$2$5,this.get_storyPointId());},hideUberMenu:function(){this.raiseActionEvent$1(ss.Int32).call(this,this.$2$6,this.get_storyPointId());},closeUber:function(){this.raiseActionEvent(this.$2$7);},markPointUpdated:function(){this.raiseActionEvent$1(ss.Int32).call(this,this.$2$8,this.get_storyPointId());},clickStoryPoint:function(){return this.$2(ss.mkdel(this,function(){return n.setActiveStoryPoint(this.$7,this.$6);}),this.get_isCurrentPoint());},revertStoryPoint:function(){return this.$2(ss.mkdel(this,function(){return n.revertStoryPoint(tab.ModelUtils.findContentDashboard().get_sheetPath(),this.$3().storyPointId);}),this.get_isCaptured());},captureStoryPoint:function(){return this.$2(ss.mkdel(this,function(){return n.captureStoryPoint(this.get_storyPointId());}),this.get_isCaptured());},deleteStoryPoint:function(){return this.$2(ss.mkdel(this,function(){return n.deleteStoryPoint(this.get_storyPointId());}),false);},editStoryPointCaption:function(A){return this.$2(ss.mkdel(this,function(){return n.editStoryPointCaption(A,this.get_storyPointId(),this.$6);}),ss.compareStrings(this.get_caption(),A,false)===0);},$2:function(A,B){var C=$.Deferred();if(B){return C.resolve(this);}else{var D=ss.mkdel(this,function(){C.resolve(this);});var E=function(){C.reject(ss.cast(arguments[0],tab.IStoryPointCaptionViewModel));};var F=A();F.then(D,E);}return C.promise();}},spiff.BaseViewModel,[ss.IDisposable,tab.IViewModel,tab.IStoryPointCaptionViewModel]);ss.initClass(y,a,{});ss.initClass(z,a,{get_isShowing:function(){return false;},get_isShowingWithHide:function(){return false;},get_targetStoryPointId:function(){return 0;},get_timeoutMs:function(){return this.$1$1;},set_timeoutMs:function(A){this.$1$1=A;},get_fadeMs:function(){return this.$1$2;},set_fadeMs:function(A){this.$1$2=A;},updatePoints:function(A,B){},showUber:function(A){},hideUberWithTimeoutAndFade:function(){},hideUberWithFade:function(){},showUberWithTimeoutAndFade:function(A){},close:function(){},dispose:function(){}},null,[ss.IDisposable,m]);(function(){c.$0="<span class='tabFlipboardNavPoints'/>";})();(function(){d.$0="<div class='tabFlipboardNav'><span class='tabFlipboardNavPrevious'><div class='tabStoryLeftArrow'/></span><span class='tabFlipboardNavScroller'/><span class='tabFlipboardNavNext'><div class='tabStoryRightArrow'/></span></div>";})();(function(){y.$1$1=null;y.$1$2=null;})();(function(){e.horizontalScrollerSelector='.tabFlipboardNavScroller .iScrollHorizontalScrollbar';e.horizontalScrollerHoverSelector='.tabFlipboardNavScroller .iScrollHorizontalScrollbar:hover';e.horizontalScrollerIndicatorSelector='.tabFlipboardNavScroller .iScrollHorizontalScrollbar>.iScrollIndicator';e.horizontalScrollerIndicatorHoverSelector='.tabFlipboardNavScroller .iScrollHorizontalScrollbar>.iScrollIndicator:hover';e.storyPointSelector='.tabFlipboardNavScroller .tabScroller .tabScrollerContent .tabFlipboardNavPoints .tabStoryPoint';e.selectedStoryPointBoxSelector='.tabStoryPointCaption.tabCurrent';e.unselectedStoryPointBoxSelector='.tabStoryPointCaption';e.selectedStoryPointTextSelector='.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabScrollerContentWindow .tabScrollerContent .tabStoryPointContent';e.unselectedStoryPointTextSelector='.tabStoryPointCaption .tabCustomScroller .tabScrollerContentWindow .tabScrollerContent .tabStoryPointContent';e.selectedStoryPointScrollbarSelector='.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar';e.unselectedStoryPointScrollbarSelector='.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar';e.selectedStoryPointScrollbarIndicatorSelector='.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator';e.unselectedStoryPointScrollbarIndicatorSelector='.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator';e.selectedStoryPointScrollbarIndicatorHoverSelector='.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator:hover';e.unselectedStoryPointScrollbarIndicatorHoverSelector='.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator:hover';e.selectedStoryPointNativeScrollerTopBottomSelector='.tabStoryPointCaption.tabCurrent .tabStoryPointCaptionTop,.tabStoryPointCaption.tabCurrent .tabStoryPointCaptionBottom';e.unselectedStoryPointNativeScrollerTopBottomSelector='.tabStoryPointCaption.tabStoryPointCaptionTop,.tabStoryPointCaption .tabStoryPointCaptionBottom';e.selectedStoryPointNativeScrollerTextSelector='.tabStoryPointCaption.tabCurrent .tabScroller .tabScrollerContent .tabStoryPointContent';e.unselectedStoryPointNativeScrollerTextSelector='.tabStoryPointCaption .tabScroller .tabScrollerContent .tabStoryPointContent';e.storyStyleSheetId='appendedStoryStyle';tab.ObjectRegistry.registerType(j,e).call(null);})();(function(){g.flipboardClassName='tabFlipboard';g.$0="<div class='tabFlipboard'></div>";})();(function(){h.scrollBarThickness=24;h.additionalHeightForMarginsOfContent=3;tab.ObjectRegistry.registerType(h,h).call(null);})();(function(){v.$0="<div class='tabStoryPointContent'/>";})();(function(){s.circleClassName='tabStoryPointCircle';s.storyPointDotClassName='tabStoryPointDot';s.dotsScale=0.75;})();(function(){u.centeredClassName='centered';u.paddedClassName='padded';})();(function(){w.$0="<span class='tabStoryPoint'>\n<div class='tabStoryPointToolbar'>\n  <div class='tabStoryRevert'></div>  <div class='tabStoryUpdate'><div class='tabStoryUpdateTextButton'></div><div class='tabStoryUpdateIconButton'></div></div>\n  <div class='tabStoryDelete'></div></div>\n<div class='tabStoryPointCaption'><div class='tabStoryPointCaptionTop'/><div class='tabStoryPointCaptionBottom'/></div></span>";})();(function(){r.centeredClassName='centered';r.buttonPixelBuffer=12;r.revertUpdateSpacing=4;tab.ObjectRegistry.registerType(l,r).call(null);})();(function(){tab.ObjectRegistry.registerType(m,z).call(null);})();})();// END StoryModule
